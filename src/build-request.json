{
  "kind": "build_request",
  "title": "Fix runtime config parsing of env.json and redeploy frontend so backend canister ID resolves in production",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update the frontend runtime configuration loader to correctly read the backend canister ID from the production `/env.json` format that uses `backend_canister_id` (in addition to the existing `CANISTER_ID_BACKEND` and `canisterId` keys), so the app can resolve the backend canister ID at runtime.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-messages"
        ],
        "quotes": [
          "this is in env.json\n\n{\n  \"backend_host\": \"https://icp-api.io\",\n  \"backend_canister_id\": \"bw6w3-liaaa-aaaao-a6lja-cai\",\n  \"project_id\": \"019c2bca-2092-7451-929c-3788d243f166\",\n  \"ii_derivation_origin\": \"https://simple-data-logging-web-app-with-motoko-http-endpo-d3a.caffeine.xyz\"\n}"
        ]
      },
      "acceptanceCriteria": [
        "When `/env.json` contains `backend_canister_id`, `resolveBackendCanisterId()` returns that value as `backendCanisterId` (not null).",
        "The console no longer logs: \"[RuntimeConfig] Failed to resolve backend canister ID from any source\" when `/env.json` is reachable and contains `backend_canister_id`.",
        "The UI no longer shows the \"Configuration Loading Failed\" state when `/env.json` contains a valid `backend_canister_id`."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Align the checked-in static `frontend/public/env.json` key naming with what the runtime loader supports by including a compatible backend canister ID key (so local/static hosting doesn’t default to an empty `CANISTER_ID_BACKEND`).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-messages"
        ],
        "quotes": [
          "this is in env.json\n\n{\n  \"backend_host\": \"https://icp-api.io\",\n  \"backend_canister_id\": \"bw6w3-liaaa-aaaao-a6lja-cai\",\n  \"project_id\": \"019c2bca-2092-7451-929c-3788d243f166\",\n  \"ii_derivation_origin\": \"https://simple-data-logging-web-app-with-motoko-http-endpo-d3a.caffeine.xyz\"\n}"
        ]
      },
      "acceptanceCriteria": [
        "`frontend/public/env.json` contains a non-empty key that the loader can read (either `backend_canister_id` or `CANISTER_ID_BACKEND`), or includes both keys consistently.",
        "With a populated `frontend/public/env.json`, the app resolves a backend canister ID without requiring any build-time env vars or `window.CANISTER_ID_BACKEND`."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Perform a clean frontend-only rebuild/redeploy to production so the updated runtime config loader is included in the deployed JS bundle and the production app successfully initializes using `/env.json`.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-messages"
        ],
        "quotes": [
          "Do you want me to trigger a frontend‑only rebuild and push it to production?",
          "yes"
        ]
      },
      "acceptanceCriteria": [
        "Loading https://simple-data-logging-web-app-with-motoko-http-endpo-d3a.caffeine.xyz/ in a fresh/incognito session successfully renders the app without the configuration failure card.",
        "The HTTP Logging API card displays working endpoint URLs that include the resolved canister ID (e.g., `https://<canisterId>.raw.icp0.io/...`)."
      ]
    }
  ],
  "constraints": [
    "Do not edit files under `frontend/src/components/ui` (read-only UI primitives).",
    "Do not modify immutable hook files: `frontend/src/hooks/useInternetIdentity.ts`, `frontend/src/hooks/useInternetIdentity.tsx`, `frontend/src/hooks/useActor.ts`, `frontend/src/main.tsx`.",
    "Keep backend as a single Motoko actor; no backend changes are required for this fix."
  ],
  "nonGoals": [
    "Adding new product features beyond fixing runtime configuration resolution and redeploying the frontend.",
    "Changing authentication behavior or Internet Identity integration.",
    "Introducing external databases or third-party configuration services."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}